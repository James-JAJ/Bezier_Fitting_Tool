import cv2
import numpy as np
#bezier check
def bezier_curve_calculate(points, num_of_points=50):
    """
    âœ… åŠŸèƒ½ï¼š
        æ ¹æ“šä¸€çµ„å››å€‹ä¸‰æ¬¡è²èŒ²æ›²ç·šæŽ§åˆ¶é»žï¼Œç”¢ç”Ÿè©²æ›²ç·šä¸Šå‡å‹»æŠ½æ¨£çš„é»žï¼ˆé›¢æ•£åŒ–è¡¨ç¤ºï¼‰

    Args:
        points (list of tuple): å››å€‹è²èŒ²æ›²ç·šæŽ§åˆ¶é»žï¼Œä¾‹å¦‚ [(x0, y0), (x1, y1), (x2, y2), (x3, y3)]
        num_of_points (int): è¦ç”Ÿæˆå¤šå°‘å€‹æ›²ç·šä¸Šçš„é»žï¼ˆé è¨­ç‚º 50ï¼‰

    Returns:
        curve_points (list of tuple): å›žå‚³é›¢æ•£é»žçµ„æˆçš„è²èŒ²æ›²ç·š [(x1,y1), (x2,y2), ..., (xn,yn)]

    âš ï¸ å‚™è¨»ï¼š
        - æ‰€æœ‰æŽ§åˆ¶é»žçš„åº§æ¨™æ‡‰ç‚ºæ•´æ•¸ï¼Œå¦å‰‡çµæžœæœƒå› æµ®é»žè½‰æ›é€ æˆä¸å¿…è¦çš„åå·®
        - æœ€å¾Œå›žå‚³çš„æ¯å€‹é»žæœƒè¢«è½‰æˆ `int`ï¼Œæ‰€ä»¥å¦‚æžœç²¾åº¦æœ‰è¦æ±‚ï¼ˆå¦‚ SVGï¼‰ï¼Œå»ºè­°è‡ªè¡Œä¿ç•™ float
        - num_of_points æ•¸å€¼è¶Šå¤§ï¼Œæ›²ç·šè¶Šå¹³æ»‘ï¼Œä½†è¨ˆç®—é‡ä¹Ÿæœƒæé«˜

    ðŸ’¡ è£œå……ï¼š
        é€™æ˜¯æ¨™æº–çš„ä¸‰æ¬¡è²èŒ²å…¬å¼ï¼š
            B(t) = (1âˆ’t)^3 * P0 + 3(1âˆ’t)^2 * t * P1 + 3(1âˆ’t) * t^2 * P2 + t^3 * P3
        å…¶ä¸­ t âˆˆ [0, 1]ï¼Œä»¥ç­‰è·æ–¹å¼æ’å€¼ã€‚
    """
    curve_points = []
    for t in np.linspace(0, 1, num_of_points):
        x = float((1 - t)**3 * points[0][0] + 3 * (1 - t)**2 * t * points[1][0] + 3 * (1 - t) * t**2 * points[2][0] + t**3 * points[3][0])
        y = float((1 - t)**3 * points[0][1] + 3 * (1 - t)**2 * t * points[1][1] + 3 * (1 - t) * t**2 * points[2][1] + t**3 * points[3][1])
        curve_points.append((int(x), int(y)))
    return curve_points

def draw_curve_on_image(image, curve_points, thickness=1, color=(0, 0, 255)):
    """
    âœ… åŠŸèƒ½ï¼š
        å°‡è²èŒ²æ›²ç·šçš„é»žé›†åˆï¼ˆé›¢æ•£é»žï¼‰ç•«åœ¨ä¸€å¼µå½±åƒä¸Š

    Args:
        image (ndarray): è¦ç•«ç·šçš„åœ–ç‰‡ï¼ˆå¿…é ˆæ˜¯ OpenCV åœ–åƒæ ¼å¼ï¼Œé€šå¸¸ç‚º BGRï¼‰
        curve_points (list of tuple): æ›²ç·šçš„é»žåº§æ¨™ [(x1, y1), (x2, y2), ...]
        thickness (int): ç·šæ¢ç²—ç´°ï¼ˆé è¨­ç‚º 1ï¼‰
        color (tuple): ç·šæ¢é¡è‰²ï¼Œé è¨­ç´…è‰² (0, 0, 255)

    Returns:
        image (ndarray): å›žå‚³å·²ç¶“ç•«å¥½ç·šçš„åœ–ç‰‡

    âš ï¸ å‚™è¨»ï¼š
        - `isClosed=False`ï¼Œè¡¨ç¤ºé€™æ¢è²èŒ²æ›²ç·šä¸æœƒè‡ªå‹•é–‰åˆï¼Œå¦‚éœ€å°é–‰è«‹è‡ªè¡Œé€£æŽ¥é¦–å°¾
        - è«‹ç¢ºä¿ `curve_points` ä¸­è‡³å°‘æœ‰å…©å€‹é»žï¼Œå¦å‰‡ä¸æœƒç•«ä»»ä½•æ±è¥¿
        - ç•«åœ¨åŽŸåœ–ä¸Šï¼Œæœƒæ”¹è®Šå‚³å…¥çš„ `image`ï¼›å¦‚éœ€ä¿ç•™åŽŸåœ–ï¼Œè«‹å…ˆè¤‡è£½

    ðŸ’¡ è£œå……ï¼š
        `cv2.polylines` æ˜¯ç”¨ç›´ç·šæ®µé€£æŽ¥é»žé™£ï¼Œä¸¦éžçœŸæ­£çš„é€£çºŒæ›²ç·šã€‚
        è‹¥æƒ³å°Žå‡ºç²¾ç¢º SVG è²èŒ²ï¼Œå»ºè­°ç”¨ path èªžæ³• `M...C...` è¡¨é”ã€‚
    """
    if len(curve_points) >= 2:
        pts = np.array(curve_points, dtype=np.int32).reshape((-1, 1, 2))
        cv2.polylines(image, [pts], isClosed=False, color=color, thickness=thickness)
    return image

